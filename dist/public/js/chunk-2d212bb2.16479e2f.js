(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d212bb2"],{aa51:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-row",{attrs:{gutter:16}},[r("el-col",{staticStyle:{"min-width":"300px","margin-bottom":"16px"},attrs:{lg:{span:9}}},[r("el-card",[r("div",{staticStyle:{"overflow-x":"auto","overflow-y":"hidden"}},[r("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.treeLoading,expression:"treeLoading"}],staticStyle:{"margin-right":"16px","min-height":"100px"},attrs:{data:e.treeData,"default-expand-all":!0,"expand-on-click-node":!1},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node,n=t.data;return r("span",{staticClass:"config-tree-node"},[n.isApp?r("span",[e._v(e._s(a.label))]):r("span",{on:{click:function(t){return e.treeClick(n)}}},[e._v(e._s(a.label))]),r("span",[n.isApp?r("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-plus",loading:e.treeLoading},on:{click:function(t){return e.append(n)}}}):r("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-minus",loading:e.treeLoading},on:{click:function(t){return e.remove(a,n)}}})],1)])}}])})],1)])],1),r("el-col",{directives:[{name:"show",rawName:"v-show",value:e.currRole.id&&""!==e.currRole.id,expression:"currRole.id&&currRole.id!==''"}],staticStyle:{"margin-bottom":"16px"},attrs:{lg:{span:15}}},[r("el-card",[r("div",{attrs:{slot:"header"},slot:"header"},[e._v(e._s(e.currRoleFullPath))]),r("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[r("el-tab-pane",{attrs:{name:"basicInfo"}},[r("span",{attrs:{slot:"label"},slot:"label"},[r("i",{staticClass:"el-icon-info",staticStyle:{"margin-right":"5px"}}),e._v(e._s(e.$t("forms.basicInfo")))]),r("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.treeLoading,expression:"treeLoading"}],ref:"editForm",attrs:{size:"mini",model:e.editForm,rules:e.ruleEditForm,"label-width":"60px"},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-form-item",{attrs:{label:e.$t("forms.name"),prop:"name"}},[r("el-input",{ref:"name",attrs:{disabled:e.treeLoading,placeholder:e.$t("forms.pleaseEnter")+e.$t("forms.name")},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.doSave(t)}},model:{value:e.editForm.name,callback:function(t){e.$set(e.editForm,"name",t)},expression:"editForm.name"}})],1),r("el-form-item",{attrs:{label:e.$t("forms.code"),prop:"code"}},[r("el-autocomplete",{attrs:{disabled:e.treeLoading,"fetch-suggestions":e.querySearch,placeholder:e.$t("forms.pleaseEnter")+e.$t("forms.code")},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.doSave(t)}},model:{value:e.editForm.code,callback:function(t){e.$set(e.editForm,"code",t)},expression:"editForm.code"}})],1),r("el-form-item",{attrs:{label:e.$t("forms.level"),prop:"levels"}},[r("el-input-number",{staticStyle:{width:"100%","max-width":"150px"},attrs:{disabled:e.treeLoading,placeholder:e.$t("forms.pleaseEnter")+e.$t("forms.level"),min:0},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.doSave(t)}},model:{value:e.editForm.levels,callback:function(t){e.$set(e.editForm,"levels",t)},expression:"editForm.levels"}})],1),r("el-form-item",{attrs:{label:e.$t("forms.sort"),prop:"sort"}},[r("el-input-number",{staticStyle:{width:"100%","max-width":"150px"},attrs:{disabled:e.treeLoading,placeholder:e.$t("forms.pleaseEnter")+e.$t("forms.sort"),min:0},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.doSave(t)}},model:{value:e.editForm.sort,callback:function(t){e.$set(e.editForm,"sort",t)},expression:"editForm.sort"}})],1)],1)],1),r("el-tab-pane",{attrs:{name:"people"}},[r("span",{attrs:{slot:"label"},slot:"label"},[r("i",{staticClass:"el-icon-user",staticStyle:{"margin-right":"5px"}}),e._v(e._s(e.$t("forms.userList")))]),r("el-transfer",{directives:[{name:"loading",rawName:"v-loading",value:e.treeLoading,expression:"treeLoading"}],attrs:{data:e.optionalUsers,filterable:!0,props:{key:"id"},titles:[e.$t("forms.optional"),e.$t("forms.selected")],"button-texts":[e.$t("forms.buttons.cancel"),e.$t("forms.buttons.select")]},on:{change:e.handleUserListChange},model:{value:e.editForm.userIds,callback:function(t){e.$set(e.editForm,"userIds",t)},expression:"editForm.userIds"}})],1),r("el-tab-pane",{attrs:{name:"menuList"}},[r("span",{attrs:{slot:"label"},slot:"label"},[r("i",{staticClass:"el-icon-s-order",staticStyle:{"margin-right":"5px"}}),e._v(e._s(e.$t("forms.menuList")))]),r("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.treeLoading,expression:"treeLoading"}],ref:"menuTree",attrs:{data:e.menuData,"show-checkbox":!0,"node-key":"id","default-expanded-keys":e.editForm.menuIds}})],1),r("el-tab-pane",{attrs:{name:"moduleFuncList"}},[r("span",{attrs:{slot:"label"},slot:"label"},[r("i",{staticClass:"el-icon-s-grid",staticStyle:{"margin-right":"5px"}}),e._v(e._s(e.$t("forms.moduleFuncList")))]),r("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.treeLoading,expression:"treeLoading"}],ref:"moduleFuncTree",attrs:{data:e.moduleFuncData,"show-checkbox":!0,"node-key":"id","default-expanded-keys":e.editForm.moduleFuncIds}})],1)],1),r("div",{staticStyle:{"text-align":"center"}},[r("el-button",{staticStyle:{"margin-right":"20px"},attrs:{type:"info",loading:e.treeLoading},on:{click:e.doReset}},[e._v("\n          "+e._s(e.$t("forms.buttons.reset"))+"\n        ")]),r("el-button",{attrs:{type:"primary",loading:e.treeLoading},on:{click:e.doSave}},[e._v("\n          "+e._s(e.$t("forms.buttons.submit"))+"\n        ")])],1)],1)],1)],1)},n=[],o=(r("55dd"),r("20d6"),r("7f7f"),r("ac4d"),r("8a81"),r("ac6a"),r("90de")),i={name:"roleConfig",data:function(){return{activeName:"basicInfo",treeData:[],menuData:[],moduleFuncData:[],tree_loading:!1,roleCode:[],currRoleFullPath:"",currRoleData:{},currRole:{},editForm:{id:"",appId:"",name:"",code:"",levels:999,sort:1,userIds:[],menuIds:[],moduleFuncIds:[]},optionalUsers:[]}},computed:{ruleEditForm:function(){return{name:[{required:!0,message:this.$i18n.t("forms.name")+this.$i18n.t("forms.notEmpty"),trigger:"blur"}],code:[{type:"string",required:!0,message:this.$i18n.t("forms.code")+this.$i18n.t("forms.notEmpty"),trigger:"change"}],levels:[{type:"integer",required:!0,message:this.$i18n.t("forms.level")+this.$i18n.t("forms.notEmpty"),trigger:"blur"}],sort:[{type:"integer",required:!0,message:this.$i18n.t("forms.sort")+this.$i18n.t("forms.notEmpty"),trigger:"blur"}]}},treeLoading:function(){return this.tree_loading}},methods:{querySearch:function(e,t){var r=this.roleCode,a=e?r.filter(function(t){return 0===t.value.toLowerCase().indexOf(e.toLowerCase())}):r;t(a)},refreshTree:function(){var e=this;this.clearCurrObj(),this.tree_loading=!0,this.$api.request.app.getList().then(function(t){if(t){for(var r=t.data,a=0;a<r.length;a++){var n=r[a];n.isApp=!0,n.appId=n.id,n.name=n.appName,n.label=n.appName,n.sort=a,n.children=[]}e.tree_loading=!0,e.$api.request.role.getList().then(function(t){if(e.tree_loading=!1,t){Object(o["j"])(t.data);var a=!0,n=!1,i=void 0;try{for(var s,d=t.data[Symbol.iterator]();!(a=(s=d.next()).done);a=!0){var l=s.value;l.parentId=l.appId;var u=!0,c=!1,m=void 0;try{for(var f,p=r[Symbol.iterator]();!(u=(f=p.next()).done);u=!0){var h=f.value;h.id===l.appId&&h.children.push(l)}}catch(g){c=!0,m=g}finally{try{u||null==p.return||p.return()}finally{if(c)throw m}}}}catch(g){n=!0,i=g}finally{try{a||null==d.return||d.return()}finally{if(n)throw i}}e.treeData=r}}).catch(function(){e.tree_loading=!1})}}).catch(function(){e.tree_loading=!1})},refreshRoleCodeList:function(){var e=this;this.tree_loading=!0,this.$api.request.role.getCodeList().then(function(t){e.tree_loading=!1,t&&(e.roleCode=t.data.map(function(e){var t={};return t.value=e,t}))}).catch(function(){e.tree_loading=!1})},reloadUserList:function(){var e=this;this.tree_loading=!0,this.$api.request.user.getModifiableUser().then(function(t){e.tree_loading=!1,t&&(e.optionalUsers=t.data.map(function(e){return e.label=e.name+"("+e.loginNo+")",e}))}).catch(function(){e.tree_loading=!1})},reloadMenuList:function(e){var t=this;this.tree_loading=!0,this.$api.request.auth.getMenuList(this.currRole.appId).then(function(r){t.tree_loading=!1,r&&(Object(o["j"])(r.data),t.menuData=r.data,"function"===typeof e&&e())}).catch(function(){t.tree_loading=!1})},reloadModuleFuncList:function(e){var t=this;this.tree_loading=!0,this.$api.request.auth.getModuleFuncList(this.currRole.appId).then(function(r){t.tree_loading=!1,r&&(Object(o["j"])(r.data),t.moduleFuncData=r.data,"function"===typeof e&&e())}).catch(function(){t.tree_loading=!1})},clearCurrObj:function(e){(!e||e&&e===this.currRole.id)&&(this.editForm={id:"",name:"",code:"",levels:1,sort:0,userIds:[],menuIds:[],moduleFuncIds:[]},this.currRole={id:"",appId:"",name:"",code:"",levels:1,sort:0,userIds:[],menuIds:[],moduleFuncIds:[]},this.currRoleData={})},append:function(e){var t=this;this.tree_loading=!0,this.$api.request.role.createRole({name:this.$i18n.t("forms.new")+this.$i18n.t("forms.role"),appId:e.appId,sort:e.children.length+1,code:"BUSINESS",levels:999}).then(function(r){if(t.tree_loading=!1,r){t.$message.success(t.$i18n.t("messages.createSuccess")+"");var a=e.children||[];Object(o["j"])([r.data]),a.push(r.data),Object(o["k"])(a),t.treeClick(r.data),t.$set(e,"children",a)}}).catch(function(){t.tree_loading=!1})},remove:function(e,t){var r=this;this.$confirm(this.$i18n.t("messages.deleteDataConfirm")+": "+Object(o["i"])(this.treeData,t.id),this.$i18n.t("dialog.confirm")+"",{type:"warning"}).then(function(){r.tree_loading=!0,r.$api.request.role.deleteRole([t.id]).then(function(a){if(r.tree_loading=!1,a){r.$message.success(r.$i18n.t("messages.deleteSuccess")+"");var n=e.parent,o=n.data.children,i=o.findIndex(function(e){return e.id===t.id});o.splice(i,1),r.clearCurrObj(t.id)}}).catch(function(){r.tree_loading=!1})}).catch(function(){})},treeClick:function(e){var t=this;this.tree_loading=!0,this.$api.request.role.getRoleInfo(e.id).then(function(r){t.tree_loading=!1,r&&(t.currRoleData=e,t.currRoleData.userIds=r.data.userIds,t.currRoleData.menuIds=r.data.menuIds,t.currRoleData.moduleFuncIds=r.data.moduleFuncIds,t.currRole={id:t.currRoleData.id,appId:t.currRoleData.appId,name:t.currRoleData.name,code:t.currRoleData.code,levels:t.currRoleData.levels,sort:t.currRoleData.sort,userIds:t.currRoleData.userIds,menuIds:t.currRoleData.menuIds,moduleFuncIds:t.currRoleData.moduleFuncIds},t.doReset(),t.$nextTick(function(){t.$refs["name"].focus()}))}).catch(function(){t.tree_loading=!1})},doSave:function(){var e=this;this.$refs["editForm"].validate(function(t){t&&(e.tree_loading=!0,e.$api.request.role.doUpdateRole({id:e.editForm.id,name:e.editForm.name,code:e.editForm.code,levels:e.editForm.levels,sort:e.editForm.sort,userIds:e.editForm.userIds,menuIds:e.$refs["menuTree"].getCheckedNodes(!1,!0).map(function(e){return e.id}),moduleFuncIds:e.$refs["moduleFuncTree"].getCheckedNodes(!1,!0).map(function(e){return e.id})}).then(function(t){e.tree_loading=!1,t&&(e.reloadUserList(),e.$message.success(e.$i18n.t("messages.saveSuccess")+""),e.currRoleData.name=e.editForm.name,e.currRoleData.title=e.editForm.name,e.currRoleData.label=e.editForm.name,e.currRoleData.code=e.editForm.code,e.currRoleData.levels=e.editForm.levels,e.currRoleData.sort=e.editForm.sort,e.currRoleData.userIds=e.editForm.userIds,e.currRoleData.menuIds=e.$refs["menuTree"].getCheckedNodes(!1,!0).map(function(e){return e.id}),e.currRoleData.moduleFuncIds=e.$refs["moduleFuncTree"].getCheckedNodes(!1,!0).map(function(e){return e.id}),e.currRole={id:e.editForm.id,appId:e.editForm.appId,name:e.editForm.name,code:e.editForm.code,levels:e.editForm.levels,sort:e.editForm.sort,userIds:e.editForm.userIds,menuIds:e.$refs["menuTree"].getCheckedNodes(!1,!0).map(function(e){return e.id}),moduleFuncIds:e.$refs["moduleFuncTree"].getCheckedNodes(!1,!0).map(function(e){return e.id})},e.editForm.menuIds=e.currRole.menuIds,e.editForm.moduleFuncIds=e.currRole.moduleFuncIds,e.reloadMenuList(function(){e.$nextTick(function(){var t=Object(o["d"])(e.menuData,e.editForm.menuIds);e.$refs["menuTree"].setCheckedKeys(t.checkedIdList)})}),e.reloadModuleFuncList(function(){e.$nextTick(function(){var t=Object(o["d"])(e.moduleFuncData,e.editForm.moduleFuncIds);e.$refs["moduleFuncTree"].setCheckedKeys(t.checkedIdList)})}),e.currRoleFullPath=Object(o["i"])(e.treeData,e.currRole.id),Object(o["k"])(e.treeData))}).catch(function(){e.tree_loading=!1}))})},doReset:function(){var e=this;this.reloadUserList(),this.$refs["editForm"].resetFields(),this.editForm={id:this.currRole.id,appId:this.currRole.appId,name:this.currRole.name,code:this.currRole.code,levels:this.currRole.levels,sort:this.currRole.sort,userIds:this.currRole.userIds,menuIds:this.currRole.menuIds,moduleFuncIds:this.currRole.moduleFuncIds},this.reloadMenuList(function(){e.$nextTick(function(){var t=Object(o["d"])(e.menuData,e.editForm.menuIds);e.$refs["menuTree"].setCheckedKeys(t.checkedIdList)})}),this.reloadModuleFuncList(function(){e.$nextTick(function(){var t=Object(o["d"])(e.moduleFuncData,e.editForm.moduleFuncIds);e.$refs["moduleFuncTree"].setCheckedKeys(t.checkedIdList)})}),this.currRoleFullPath=Object(o["i"])(this.treeData,this.currRole.id)},handleUserListChange:function(e){this.editForm.userIds=e}},mounted:function(){this.refreshTree(),this.reloadUserList(),this.refreshRoleCodeList()},activated:function(){var e=this;this.currRole.id&&""!==this.currRole.id&&this.$nextTick(function(){e.$refs["name"].focus()})}},s=i,d=r("2877"),l=Object(d["a"])(s,a,n,!1,null,null,null);t["default"]=l.exports}}]);