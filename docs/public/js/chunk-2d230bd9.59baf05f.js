(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d230bd9"],{ee25:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-row",{attrs:{gutter:16}},[r("el-col",{staticStyle:{"min-width":"300px","margin-bottom":"16px"},attrs:{lg:{span:9}}},[r("el-card",[r("div",{staticStyle:{"overflow-x":"auto","overflow-y":"hidden"}},[r("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.treeLoading,expression:"treeLoading"}],staticStyle:{"margin-right":"16px","min-height":"100px"},attrs:{data:e.treeData,"default-expand-all":!0,"expand-on-click-node":!1},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node,i=t.data;return r("span",{staticClass:"config-tree-node"},["root"!==i.id?r("span",{on:{click:function(t){return e.orgClick(i)}}},[e._v(e._s(a.label))]):r("span",[e._v(e._s(a.label))]),r("span",["root"!==i.id?r("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-minus",loading:e.treeLoading},on:{click:function(t){return e.remove(a,i)}}}):e._e(),r("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-plus",loading:e.treeLoading},on:{click:function(t){return e.append(i)}}})],1)])}}])})],1)])],1),r("el-col",{directives:[{name:"show",rawName:"v-show",value:e.currOrg.id&&""!==e.currOrg.id,expression:"currOrg.id&&currOrg.id!==''"}],staticStyle:{"margin-bottom":"16px"},attrs:{lg:{span:15}}},[r("el-card",[r("div",{attrs:{slot:"header"},slot:"header"},[e._v(e._s(e.currOrgFullPath))]),r("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.treeLoading,expression:"treeLoading"}],ref:"editForm",attrs:{size:"mini",model:e.editForm,rules:e.ruleEditForm,"label-width":"80px"},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-col",{attrs:{sm:{span:12}}},[r("el-form-item",{attrs:{label:e.$t("forms.name"),prop:"name"}},[r("el-input",{ref:"name",attrs:{disabled:e.treeLoading,placeholder:e.$t("forms.pleaseEnter")+e.$t("forms.name")},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.doSave(t)}},model:{value:e.editForm.name,callback:function(t){e.$set(e.editForm,"name",t)},expression:"editForm.name"}})],1)],1),r("el-col",{attrs:{sm:{span:12}}},[r("el-form-item",{attrs:{label:e.$t("forms.code"),prop:"code"}},[r("el-input",{attrs:{disabled:e.treeLoading,placeholder:e.$t("forms.pleaseEnter")+e.$t("forms.code")},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.doSave(t)}},model:{value:e.editForm.code,callback:function(t){e.$set(e.editForm,"code",t)},expression:"editForm.code"}})],1)],1),r("el-col",{attrs:{sm:{span:12}}},[r("el-form-item",{attrs:{label:e.$t("forms.parent"),prop:"parentArray"}},[r("el-cascader",{directives:[{name:"loading",rawName:"v-loading",value:e.treeLoading,expression:"treeLoading"}],staticStyle:{width:"100%"},attrs:{options:e.cascaderData,disabled:e.treeLoading,props:{checkStrictly:!0,value:"id"}},model:{value:e.editForm.parentArray,callback:function(t){e.$set(e.editForm,"parentArray",t)},expression:"editForm.parentArray"}})],1)],1),r("el-col",{attrs:{sm:{span:12}}},[r("el-form-item",{attrs:{label:e.$t("forms.sort"),prop:"sort"}},[r("el-input-number",{attrs:{disabled:e.treeLoading,placeholder:e.$t("forms.pleaseEnter")+e.$t("forms.sort"),min:0},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.doSave(t)}},model:{value:e.editForm.sort,callback:function(t){e.$set(e.editForm,"sort",t)},expression:"editForm.sort"}})],1)],1),r("el-col",{attrs:{sm:{span:24}}},[r("el-form-item",{attrs:{label:e.$t("forms.userList")}},[r("el-transfer",{directives:[{name:"loading",rawName:"v-loading",value:e.treeLoading,expression:"treeLoading"}],attrs:{data:e.optionalUsers,filterable:!0,props:{key:"id"},titles:[e.$t("forms.optional"),e.$t("forms.selected")],"button-texts":[e.$t("forms.buttons.cancel"),e.$t("forms.buttons.select")]},on:{change:e.handleUserListChange},model:{value:e.editForm.userIds,callback:function(t){e.$set(e.editForm,"userIds",t)},expression:"editForm.userIds"}})],1)],1),r("div",{staticStyle:{"text-align":"center"}},[r("el-button",{staticStyle:{"margin-right":"20px"},attrs:{type:"info",loading:e.treeLoading},on:{click:e.doReset}},[e._v("\n            "+e._s(e.$t("forms.buttons.reset"))+"\n          ")]),r("el-button",{attrs:{type:"primary",loading:e.treeLoading},on:{click:e.doSave}},[e._v("\n            "+e._s(e.$t("forms.buttons.submit"))+"\n          ")])],1)],1)],1)],1)],1)},i=[],n=(r("55dd"),r("20d6"),r("7f7f"),r("90de")),o={name:"orgConfig",data:function(){return{treeData:[{id:"root",label:this.$i18n.t("forms.organization"),children:[]}],tree_loading:!1,currOrgFullPath:"",currOrgData:{},currOrg:{},editForm:{},optionalUsers:[]}},computed:{ruleEditForm:function(){return{name:[{required:!0,message:this.$i18n.t("forms.name")+this.$i18n.t("forms.notEmpty"),trigger:"blur"}],sort:[{type:"integer",required:!0,message:this.$i18n.t("forms.sort")+this.$i18n.t("forms.notEmpty"),trigger:"blur"}],parentArray:[{type:"array",required:!0,message:this.$i18n.t("forms.parent")+this.$i18n.t("forms.notEmpty"),trigger:"on-change"}]}},treeLoading:function(){return this.tree_loading},cascaderData:function(){return Object(n["c"])(Object(n["a"])(this.treeData),[this.editForm.id])},parentArray:function(){return this.editForm.parentArray}},watch:{parentArray:function(e){e.length>0?this.editForm.parentId=e[e.length-1]:this.editForm.parentId=""}},methods:{clearCurrOrg:function(e){(!e||e&&e===this.currOrg.id)&&(this.editForm={id:"",name:"",code:"",parentArray:[],parentId:"",sort:0,userIds:[]},this.currOrg={id:"",name:"",code:"",parentId:"",sort:0,userIds:[]},this.currOrgData={})},refreshOrgTree:function(){var e=this;this.clearCurrOrg(),this.tree_loading=!0,this.$api.request.org.getOrgList().then(function(t){e.tree_loading=!1,t&&(Object(n["j"])(t.data),e.treeData[0].children=t.data)}).catch(function(){e.tree_loading=!1})},reloadUserList:function(){var e=this;this.tree_loading=!0,this.$api.request.user.getModifiableUser().then(function(t){e.tree_loading=!1,t&&(e.optionalUsers=t.data.map(function(e){return e.label=e.name+"("+e.loginNo+")",e}))}).catch(function(){e.tree_loading=!1})},append:function(e){var t=this;this.tree_loading=!0,this.$api.request.org.createOrg({name:this.$i18n.t("forms.new")+this.$i18n.t("forms.organization"),parentId:e.id,sort:e.children.length+1}).then(function(r){if(t.tree_loading=!1,r){t.$message.success(t.$i18n.t("messages.createSuccess")+"");var a=e.children||[];Object(n["j"])([r.data]),a.push(r.data),Object(n["k"])(a),t.orgClick(r.data),t.$set(e,"children",a)}}).catch(function(){t.tree_loading=!1})},remove:function(e,t){var r=this;this.$confirm(this.$i18n.t("messages.deleteDataConfirm")+": "+Object(n["i"])(this.treeData,t.id),this.$i18n.t("dialog.confirm")+"",{type:"warning"}).then(function(){r.tree_loading=!0,r.$api.request.org.deleteOrg([t.id]).then(function(a){if(r.tree_loading=!1,a){r.$message.success(r.$i18n.t("messages.deleteSuccess")+"");var i=e.parent,n=i.data.children,o=n.findIndex(function(e){return e.id===t.id});n.splice(o,1),r.clearCurrOrg(t.id)}}).catch(function(){r.tree_loading=!1})}).catch(function(){})},orgClick:function(e){var t=this;this.tree_loading=!0,this.$api.request.org.getOrgInfo(e.id).then(function(r){t.tree_loading=!1,r&&(t.currOrgData=e,t.currOrgData.userIds=r.data.userIds,t.currOrg={id:t.currOrgData.id,name:t.currOrgData.name,code:t.currOrgData.code,parentId:t.currOrgData.parentId,sort:t.currOrgData.sort,userIds:t.currOrgData.userIds},t.doReset(),t.$nextTick(function(){t.$refs["name"].focus()}))}).catch(function(){t.tree_loading=!1})},doSave:function(){var e=this;this.$refs["editForm"].validate(function(t){t&&(e.tree_loading=!0,e.$api.request.org.doUpdateOrg({id:e.editForm.id,name:e.editForm.name,code:e.editForm.code,parentId:e.editForm.parentId,sort:e.editForm.sort,userIds:e.editForm.userIds}).then(function(t){if(e.tree_loading=!1,t){var r=e.currOrgData.parentId;e.reloadUserList(),e.$message.success(e.$i18n.t("messages.saveSuccess")+""),e.currOrgData.name=e.editForm.name,e.currOrgData.title=e.editForm.name,e.currOrgData.label=e.editForm.name,e.currOrgData.code=e.editForm.code,e.currOrgData.parentId=e.editForm.parentId,e.currOrgData.sort=e.editForm.sort,e.currOrgData.userIds=e.editForm.userIds,e.currOrg={id:e.editForm.id,name:e.editForm.name,code:e.editForm.code,parentId:e.editForm.parentId,sort:e.editForm.sort,userIds:e.editForm.userIds},e.currOrgFullPath=Object(n["i"])(e.treeData,e.currOrg.id),r===e.currOrgData.parentId?Object(n["k"])(e.treeData):e.refreshOrgTree()}}).catch(function(){e.tree_loading=!1}))})},doReset:function(){this.reloadUserList(),this.$refs["editForm"].resetFields(),this.editForm={id:this.currOrg.id,name:this.currOrg.name,code:this.currOrg.code,sort:this.currOrg.sort,parentArray:Object(n["h"])(this.treeData,this.currOrg.parentId).map(function(e){return e.id}),parentId:this.currOrg.parentId,userIds:this.currOrg.userIds},this.currOrgFullPath=Object(n["i"])(this.treeData,this.currOrg.id)},handleUserListChange:function(e){this.editForm.userIds=e}},mounted:function(){this.refreshOrgTree(),this.reloadUserList()},activated:function(){var e=this;this.currOrg.id&&""!==this.currOrg.id&&this.$nextTick(function(){e.$refs["name"].focus()})}},s=o,d=r("2877"),c=Object(d["a"])(s,a,i,!1,null,null,null);t["default"]=c.exports}}]);